/*!
 * Link Click tracking for Snowplow v0.3.9 (http://bit.ly/sp-js)
 * Copyright 2022 Snowplow Analytics Ltd, 2010 Anthon Pang
 * Licensed under BSD-3-Clause
 */

"use strict";!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).snowplowLinkClickTracking={})}(this,(function(e){function n(e,n,t){if(t||2===arguments.length)for(var o,r=0,a=n.length;r<a;r++)!o&&r in n||(o||(o=Array.prototype.slice.call(n,0,r)),o[r]=n[r]);return e.concat(o||Array.prototype.slice.call(n))}function t(e){for(var n,t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];return null!==(n=null==e?void 0:e.map((function(e){if("function"!=typeof e)return e;try{return e.apply(void 0,t)}catch(e){}})).filter(Boolean))&&void 0!==n?n:[]}function o(e){var n=e.event;e=n.schema;var t=n.data;return n=function(){var e,n={},t=[],o=[],r=[],a=function(e,t){null!=t&&""!==t&&(n[e]=t)};return{add:a,addDict:function(e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&a(n,e[n])},addJson:function(e,n,r){var a;if(a=r)e:{if(null!=r&&(r.constructor==={}.constructor||r.constructor===[].constructor))for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){a=!0;break e}a=!1}a&&(e={keyIfEncoded:e,keyIfNotEncoded:n,json:r},o.push(e),t.push(e))},addContextEntity:function(e){r.push(e)},getPayload:function(){return n},getJson:function(){return t},withJsonProcessor:function(n){e=n},build:function(){return null==e||e(this,o,r),n}}}(),e={schema:"iglu:com.snowplowanalytics.snowplow/unstruct_event/jsonschema/1-0-0",data:{schema:e,data:t}},n.add("e","ue"),n.addJson("ue_px","ue_pr",e),n}function r(e){return o({event:e={schema:"iglu:com.snowplowanalytics.snowplow/link_click/jsonschema/1-0-1",data:i({targetUrl:e.targetUrl,elementId:e.elementId,elementClasses:e.elementClasses,elementTarget:e.elementTarget,elementContent:e.elementContent})}})}function a(e){return o({event:e={schema:"iglu:com.conviva/button_click/jsonschema/1-0-0",data:i({elementType:e.elementType,elementId:e.elementId,elementClasses:e.elementClasses,elementName:e.elementName,elementText:e.elementText,elementValue:e.elementValue})}})}function i(e,n){void 0===n&&(n={});var t,o={};for(t in e)(n[t]||null!==e[t]&&void 0!==e[t])&&(o[t]=e[t]);return o}function c(e,n,t,o){return e.addEventListener?(e.addEventListener(n,t,o),!0):e.attachEvent?e.attachEvent("on"+n,t):void(e["on"+n]=t)}function l(e){if(null==e||"object"!=typeof e||Array.isArray(e))return function(){return!0};var n=Object.prototype.hasOwnProperty.call(e,"allowlist"),t=function(e){var n={};if(e=e.allowlist||e.denylist){Array.isArray(e)||(e=[e]);for(var t=0;t<e.length;t++)n[e[t]]=!0}return n}(e);return function(e,n){return e.hasOwnProperty("filter")&&e.filter?e.filter:n}(e,(function(e){e:{var o=0;for(e=e.className.match(/\S+/g)||[];o<e.length;o++)if(t[e[o]]){o=!0;break e}o=!1}return o===n}))}function u(e,n,t){try{var o=null!=e?e:Object.keys(n);e=[];for(var r=0;r<o.length;r++){var a=o[r];n.hasOwnProperty(a)?e.push(n[a]):b.warn(a+" not configured")}e.forEach(t)}catch(e){b.error("Function failed",e)}}function s(e,n,o){for(var a,i,c,l;null!==(a=n.parentElement)&&null!=a&&"A"!==(i=n.tagName.toUpperCase())&&"AREA"!==i;)n=a;if(null!=(a=n).href){(i=a.hostname)||(i=a.href,i=(c=/^(?:(?:https?|ftp):)\/*(?:[^@]+@)?([^:/#]+)/.exec(i))?c[1]:i),c=i.toLowerCase();var u=a.href.replace(i,c);/^(javascript|vbscript|jscript|mocha|livescript|ecmascript|mailto):/i.test(u)||(i=a.id,c=a.className.match(/\S+/g)||[],l=a.target,a=x[e.id].linkTrackingContent?a.innerHTML:void 0,u=unescape(u),e.core.getConfig().linkClickTracking&&e.core.track(r({targetUrl:u,elementId:i,elementClasses:c,elementTarget:l,elementContent:a}),t(o,n)))}}function f(e,n,o){for(var r,i,c,l,u,s;null!==(r=n.parentElement)&&null!=r&&"BUTTON"!==n.tagName.toUpperCase();)n=r;r=(l=n).id,i=l.className||"",u=l.name,s=l.type,c=l.innerText,l=l.value,e.core.getConfig().buttonClickTracking&&e.core.track(a({elementType:s,elementId:r,elementClasses:i,elementName:u,elementText:c,elementValue:l}),t(o,n))}function d(e,n){return function(t){var o=(t=t||window.event).which||t.button,r=t.target||t.srcElement;"click"===t.type?r&&s(C[e],r,n):"mousedown"===t.type?1!==o&&2!==o||!r?x[e].lastButton=x[e].lastTarget=null:(x[e].lastButton=o,x[e].lastTarget=r):"mouseup"===t.type&&(o===x[e].lastButton&&r===x[e].lastTarget&&s(C[e],r,n),x[e].lastButton=x[e].lastTarget=null)}}function p(e,n){return function(t){var o=(t=t||window.event).which||t.button,r=t.target||t.srcElement;"click"===t.type?r&&f(C[e],r,n):"mousedown"===t.type?1!==o&&2!==o||!r?L[e].lastButton=L[e].lastTarget=null:(L[e].lastButton=o,L[e].lastTarget=r):"mouseup"===t.type&&(o===L[e].lastButton&&r===L[e].lastTarget&&f(C[e],r,n),L[e].lastButton=L[e].lastTarget=null)}}function k(e,n){e=void 0===e?{}:e,x[n]={linkTrackingContent:e.trackContent,linkTrackingContext:e.context,linkTrackingPseudoClicks:e.pseudoClicks,linkTrackingFilter:l(e.options)}}function g(e,n){e=void 0===e?{}:e,L[n]={buttonTrackingContent:e.trackContent,buttonTrackingContext:e.context,buttonTrackingFilter:l(e.options)}}function v(e){var n,t,o,r=document.links;for(T=e,o=0;o<r.length;o++)if(null!==(t=null===(n=x[e])||void 0===n?void 0:n.linkTrackingFilter)&&void 0!==t&&t.call(n,r[o])&&!r[o][e]){var a=e,i=r[o];x[a].linkTrackingPseudoClicks?(c(i,"mouseup",d(a,x[a].linkTrackingContext),!1),c(i,"mousedown",d(a,x[a].linkTrackingContext),!1)):c(i,"click",d(a,x[a].linkTrackingContext),!1),r[o][e]=!0}}function h(e){try{for(var n=0;n<e.length;n++)"childList"===e[n].type&&(v(T),m(T))}catch(e){console.warn("Conviva App Tracker caused Exception in mutation callback of click tracking Plugin",e)}}function m(e){var n,t,o,r=document.querySelectorAll("button");for(o=0;o<r.length;o++)null!==(t=null===(n=L[e])||void 0===n?void 0:n.buttonTrackingFilter)&&void 0!==t&&t.call(n,r[o])&&!r[o][e]&&(c(r[o],"click",p(e,L[e].buttonTrackingContext),!1),r[o][e]=!0)}var y,w;(w=y||(y={}))[w.none=0]="none",w[w.error=1]="error",w[w.warn=2]="warn",w[w.debug=3]="debug",w[w.info=4]="info";var T,b=function(e){return void 0===e&&(e=y.warn),{setLogLevel:function(n){e=y[n]?n:y.warn},warn:function(t,o){for(var r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];e>=y.warn&&"undefined"!=typeof console&&(a="Snowplow: "+t,o?console.warn.apply(console,n([a+"\n",o],r,!1)):console.warn.apply(console,n([a],r,!1)))},error:function(t,o){for(var r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];e>=y.error&&"undefined"!=typeof console&&(a="Snowplow: "+t+"\n",o?console.error.apply(console,n([a+"\n",o],r,!1)):console.error.apply(console,n([a],r,!1)))},debug:function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];e>=y.debug&&"undefined"!=typeof console&&console.debug.apply(console,n(["Snowplow: "+t],o,!1))},info:function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];e>=y.info&&"undefined"!=typeof console&&console.info.apply(console,n(["Snowplow: "+t],o,!1))}}}(),C={},x={},L={},O=!1,E=!1;e.LinkClickTrackingPlugin=function(){return{activateBrowserPlugin:function(e){C[e.id]=e}}},e.enableButtonClickTracking=function(e,n){if(void 0===e&&(e={}),void 0===n&&(n=Object.keys(C)),E=!0,!O)try{var t=document.body;new MutationObserver(h).observe(t,{attributes:!0,childList:!0,subtree:!0})}catch(e){console.log("exception",e)}n.forEach((function(n){try{C[n]&&(C[n].sharedState.hasLoaded?(g(e,n),m(n)):C[n].sharedState.registeredOnLoadHandlers.push((function(){g(e,n),m(n)})))}catch(e){console.warn("Conviva App Tracker caused Exception in enableButtonClickTracking method in click tracking Plugin",e)}}))},e.enableLinkClickTracking=function(e,n){if(void 0===e&&(e={}),void 0===n&&(n=Object.keys(C)),O=!0,!E)try{var t=document.body;new MutationObserver(h).observe(t,{attributes:!0,childList:!0,subtree:!0})}catch(e){}n.forEach((function(n){try{C[n]&&(C[n].sharedState.hasLoaded?(k(e,n),v(n)):C[n].sharedState.registeredOnLoadHandlers.push((function(){k(e,n),v(n)})))}catch(e){console.warn("Conviva App Tracker caused Exception in enableLinkClickTracking method in click tracking Plugin",e)}}))},e.refreshButtonClickTracking=function(e){void 0===e&&(e=Object.keys(C)),e.forEach((function(e){C[e]&&(C[e].sharedState.hasLoaded?m(e):C[e].sharedState.registeredOnLoadHandlers.push((function(){m(e)})))}))},e.refreshLinkClickTracking=function(e){void 0===e&&(e=Object.keys(C)),e.forEach((function(e){C[e]&&(C[e].sharedState.hasLoaded?v(e):C[e].sharedState.registeredOnLoadHandlers.push((function(){v(e)})))}))},e.trackButtonClick=function(e,n){void 0===n&&(n=Object.keys(C)),u(n,C,(function(n){n.core.track(a(e),e.context,e.timestamp)}))},e.trackLinkClick=function(e,n){void 0===n&&(n=Object.keys(C)),u(n,C,(function(n){n.core.track(r(e),e.context,e.timestamp)}))},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.min.js.map
